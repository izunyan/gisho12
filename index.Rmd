---
site: bookdown::bookdown_site
title:  "がんばらないデータ加工：Rによる繰り返し作業入門（前編）"
author: "やわらかクジラ"
github-repo: https://github.com/izunyan/gisho12.git
cover-image: images/cover.png
documentclass: bxjsbook
classoption: xelatex,ja=standard, b5paper
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE,
                      dev = "cairo_pdf", dev.args = list(family = "ipaexg")) # pdfでggplot2の日本語出力に必要な設定→html不可？

# tibbleの表示行数指定
tibble_opt <- list(
  "tibble.print_min" = 3, # 表示する行の数
  "tibble.width" = 65     # 横の表示幅
)

options(tibble_opt)

```

# はじめに {-#hajimeni}

```{r cover, echo=FALSE, fig.align='center', out.width='60%'}
# knitr::include_graphics("images/cover.png")
```



本書『**Rで読むExcelファイル**』を書こうと思ったのは「RとRStudioを使いたい！と思う人がもっと増えればいいのに」という願いからです。使う人が多くなれば、新しい知識に出会いやすくなりますし、仕事でも使う機会が増える可能性があります。

使う人を増やすためにはよい入門書やwebサイトが必要ですが、それは巷にあふれていて無料でアクセスできるものも多いです。

例えば

 * [R for Data Science](https://r4ds.had.co.nz/)（英語） ^[https://r4ds.had.co.nz/]  
 * [日本社会心理学会　第5回春の方法論セミナー　RとRstudio入門](https://kazutan.github.io/JSSP2018_spring/index.html) ^[https://kazutan.github.io/JSSP2018_spring/index.html]
 

そこで本書では目的を絞って、R（実際はすべてRStudioから使います）を使いたいと思わせる部分を解説することを目指します。Rでどんな便利なことができるか、入門書などでもあまり深く解説されてない部分にフォーカスして紹介します。



## 本書の特徴 {-}

* これまでの解説で不足していること
  + 便利な関数や基本的な使い方の解説は多いが，データ加工の実務上知りたいコード例が豊富なわけではない
  + 同じ作業を大量の変数についてくり返し実行したい時のやり方の解説は少ない
* まずはよくあるモダンなRのデータラングリング解説
* 本書の強みは，くり返し同じ作業する部分を効率化したコードを併せて解説する点
* 自分の学習経験から，そのコード例が知りたかったんだ！という実用的な方法を収集

* 「がんばらない」とは，単純作業のくり返しに無駄なエネルギーを注がなくてよいようにすること

* まず基本の書き方を解説した後に，__【効率化】__でより効率的にコードを書く解説を行う
*【効率化】のタグが本書の核心になる。手作業の繰り返しをなるべく避けることが目指すべき点だからである。
* 冗長だが【別解】を示すことで様々な関数の働きを理解でき，データ加工の幅が広がる


本書の内容は、githubレポジトリの [](https://github.com/izunyan/excel_r) ですべて公開しています。コードやサンプルデータはこちらのレポジトリをダウンロードしてお試しください。pdf版が読みたい方は、以下のページで無料で入手可能です。自力でできる方は、`Build Book`でも作成できます。

* [技術書典マーケットの販売ページ]()

### 想定読者 {-}
色々なExcelファイルを読み込んで分析する機会があるのであれば、全くRのことを知らない方から、少しRの経験があるけど複数のファイルを一度に読みこんだことはないというレベルの方ぐらいまでが対象となるでしょう。

本書の到達目標は、RでのExcelファイルの読み書きレベルをある程度高める、という所に定めました。その先は是非好きなように可視化なり解析なり進めていただければと思います。とはいえ、そこでお好きなように！と言われても路頭に迷う方もいるかもしれないので、データの内容把握に関して、要約値や欠損値の一覧、簡単な可視化、相関の一覧についても少しだけ解説しました。その一助として、特別付録として本書と並行してまとめた、可視化のための[ggplot2の辞書](https://izunyan.github.io/practice_ggplot2/)（[特別付録について](#huroku)参照）もあります。

なお、データをきれいにする過程（例：前処理、データクリーニング、データクレンジング、データラングリングなど）については多くの説明を要するため、本書の範囲を超えます。これはまた別機会にまとめられたらなと思っています。

まず\@ref(select)章では、RStudioでファイルを読み書きする際に、最低限知っておいた方がよい知識について解説しておきます。とっつきにくいかもしれませんが、知っておいてよかったと後になって実感する類のものなので、使って慣れていきましょう。  


\@ref(filter)章は本書のメインであるExcelファイルの読み込みについて解説します。一つのファイルの読み込みから、複数シート、複数ファイルの読み込みまで、様々なシーンに対応しました。また、読みこんだファイルを一つのデータフレーム^[変数（列）とオブザベーション（行）が碁盤の目のようになった集まりの形のデータ。Excelであれば通常1行目に列名が入り、2行目以降が個別のデータを表す。データ解析において便利で分かりやすいため、本書ではデータフレームの形で説明していく]にまとめる方法についても触れています。  

章はExcelファイルの保存についてです。ここでも、一つのファイルの保存から、複数ファイルの保存まで解説します。ここまでの内容が理解できれば、大量ファイルの読み書きにまつわる単純な繰り返し作業とはさよならできるでしょう。  

章は関連知識としてcsvファイルの読み込みと保存について解説します。windowsユーザーは文字コードの違いによる文字化けというつらみと対峙することになり、初学者はここで脱落していくことが多いのではないかと思います。そのために、サバイバルスキルとして知っておくことが有用だと思い書いておきました。自分が相当苦しんだので…  

章は、読み込んだファイルの特徴をざっと把握する方法について解説しました。ここまでやれば、（きれいなデータであれば！）きっとデータ解析に入っていくことができるでしょう。

### 前提

* プロジェクト
* %>% tidyverseを読み込めば使える
* `dplyr::select()`

### 執筆環境 {-}
* 本書は[bookdown](https://bookdown.org/)にて執筆しました ^[https://bookdown.org/]

* RおよびRStudio、パッケージのバージョン
  + R version 3.6.1
  + RStudio version 1.3.1073
  + readxl version 1.3.1
  + tidyverse version 1.3.0  

## 注意事項など {-}
* 本書の内容はすべてwindows環境を想定しています。

* この本に書いてある内容は、筆者が学習したことをまとめているものにすぎないため、正常な動作の保証はできません。使用する際は、自己責任でお願いします。 


## 特別付録について {-#huroku}

本書の執筆に先駆けて、順序が違う気がしますがまず付録の作成からはじめました。特別付録は以下でアクセス可能なオンライン付録となります。     
     
* [ggplot2の辞書](https://izunyan.github.io/practice_ggplot2/)    
  + https://izunyan.github.io/practice_ggplot2/    
     
Twitterで応援してもらったら項目が増えていく仕様にしているので、もっと読みたい方は[こちらのツイート](https://twitter.com/matsuchiy/status/1277621662708453377)に何らかのレスポンスください！       
       
       
******  
          
<!-- ![](images/tweet.png)       -->