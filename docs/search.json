[{"path":"index.html","id":"hajimeni","chapter":"はじめに","heading":"はじめに","text":"本書『Rで読むExcelファイル』を書こうと思ったのは「RとRStudioを使いたい！と思う人がもっと増えればいいのに」という願いからです。使う人が多くなれば、新しい知識に出会いやすくなりますし、仕事でも使う機会が増える可能性があります。使う人を増やすためにはよい入門書やwebサイトが必要ですが、それは巷にあふれていて無料でアクセスできるものも多いです。例えばR Data Science（英語） 1日本社会心理学会　第5回春の方法論セミナー　RとRstudio入門 2そこで本書では目的を絞って、R（実際はすべてRStudioから使います）を使いたいと思わせる部分を解説することを目指します。Rでどんな便利なことができるか、入門書などでもあまり深く解説されてない部分にフォーカスして紹介します。","code":""},{"path":"index.html","id":"本書の特徴","chapter":"はじめに","heading":"本書の特徴","text":"便利なことといってもいろいろあるので、その中でも、つまづくと嫌になってしまうことの多そうな、「手元のExcelファイルを読み込む」所に着目しました。このトピックだけをRのいわゆるモダンな方法を使って重点的に解説した資料は、筆者の知る範囲では見つけられてないので、本書の最も際立った特徴といえます。また、関連するファイル形式として、csvファイルの読み書きも少しだけ触れています。こちらはつまづくことの多いであろう文字コードについても解説しました。解析したいデータが、綺麗な一つにまとまったデータばかりとは限りません。たとえば、会社の部署ごとに分かれたデータなど、解析に持っていくまでに大量のファイルを読みこまなければいけない場合もあります。その読み込みの際にいかに楽をできるかという点を意識しています。データさえスムーズに読み込めれば、後はすぐれた解説がネット上でもたくさんあり、やりたいことが可能になる環境が整うからです。Excelファイルをただ読みこむといってもいろんなバリエーションが考えられます。その単なる読みこみプロセスを通じて、Rを使う上で便利な関数や手続きを学ぶこともできるでしょう。戦いの中で自然に強くなった的な効果も見込めるかもしれません。本書の内容は、githubレポジトリの https://github.com/izunyan/excel_r ですべて公開しています。コードやサンプルデータはこちらのレポジトリをダウンロードしてお試しください。pdf版が読みたい方は、以下のページで無料で入手可能です。自力でできる方は、Build Bookでも作成できます。技術書典マーケットの販売ページ\nhttps://techbookfest.org/product/4794168259903488?productVariantID=5913872206659584\nhttps://techbookfest.org/product/4794168259903488?productVariantID=5913872206659584","code":""},{"path":"index.html","id":"想定読者","chapter":"はじめに","heading":"想定読者","text":"色々なExcelファイルを読み込んで分析する機会があるのであれば、全くRのことを知らない方から、少しRの経験があるけど複数のファイルを一度に読みこんだことはないというレベルの方ぐらいまでが対象となるでしょう。本書の到達目標は、RでのExcelファイルの読み書きレベルをある程度高める、という所に定めました。その先は是非好きなように可視化なり解析なり進めていただければと思います。とはいえ、そこでお好きなように！と言われても路頭に迷う方もいるかもしれないので、データの内容把握に関して、要約値や欠損値の一覧、簡単な可視化、相関の一覧についても少しだけ解説しました。その一助として、特別付録として本書と並行してまとめた、可視化のためのggplot2の辞書（特別付録について参照）もあります。なお、データをきれいにする過程（例：前処理、データクリーニング、データクレンジング、データラングリングなど）については多くの説明を要するため、本書の範囲を超えます。これはまた別機会にまとめられたらなと思っています。","code":""},{"path":"index.html","id":"structure","chapter":"はじめに","heading":"本書の構成","text":"まず1章では、RStudioでファイルを読み書きする際に、最低限知っておいた方がよい知識について解説しておきます。とっつきにくいかもしれませんが、知っておいてよかったと後になって実感する類のものなので、使って慣れていきましょう。2章は本書のメインであるExcelファイルの読み込みについて解説します。一つのファイルの読み込みから、複数シート、複数ファイルの読み込みまで、様々なシーンに対応しました。また、読みこんだファイルを一つのデータフレーム3にまとめる方法についても触れています。??章はExcelファイルの保存についてです。ここでも、一つのファイルの保存から、複数ファイルの保存まで解説します。ここまでの内容が理解できれば、大量ファイルの読み書きにまつわる単純な繰り返し作業とはさよならできるでしょう。??章は関連知識としてcsvファイルの読み込みと保存について解説します。windowsユーザーは文字コードの違いによる文字化けというつらみと対峙することになり、初学者はここで脱落していくことが多いのではないかと思います。そのために、サバイバルスキルとして知っておくことが有用だと思い書いておきました。自分が相当苦しんだので…??章は、読み込んだファイルの特徴をざっと把握する方法について解説しました。ここまでやれば、（きれいなデータであれば！）きっとデータ解析に入っていくことができるでしょう。","code":""},{"path":"index.html","id":"執筆環境","chapter":"はじめに","heading":"執筆環境","text":"本書はbookdownにて執筆しました 4本書はbookdownにて執筆しました 4RおよびRStudio、パッケージのバージョン\nR version 3.6.1\nRStudio version 1.3.1073\nreadxl version 1.3.1\ntidyverse version 1.3.0\nRおよびRStudio、パッケージのバージョンR version 3.6.1RStudio version 1.3.1073readxl version 1.3.1tidyverse version 1.3.0","code":""},{"path":"index.html","id":"注意事項など","chapter":"はじめに","heading":"注意事項など","text":"本書の内容はすべてwindows環境を想定しています。本書の内容はすべてwindows環境を想定しています。この本に書いてある内容は、筆者が学習したことをまとめているものにすぎないため、正常な動作の保証はできません。使用する際は、自己責任でお願いします。この本に書いてある内容は、筆者が学習したことをまとめているものにすぎないため、正常な動作の保証はできません。使用する際は、自己責任でお願いします。","code":""},{"path":"index.html","id":"huroku","chapter":"はじめに","heading":"特別付録について","text":"本書の執筆に先駆けて、順序が違う気がしますがまず付録の作成からはじめました。特別付録は以下でアクセス可能なオンライン付録となります。ggplot2の辞書\nhttps://izunyan.github.io/practice_ggplot2/\nhttps://izunyan.github.io/practice_ggplot2/Twitterで応援してもらったら項目が増えていく仕様にしているので、もっと読みたい方はこちらのツイートに何らかのレスポンスください！","code":""},{"path":"project.html","id":"project","chapter":"1 前提：プロジェクトの設定","heading":"1 前提：プロジェクトの設定","text":"Rの基本的な使い方は他の情報源にゆだねていますが、ここだけは避けて通れないので解説しておきます。","code":""},{"path":"project.html","id":"どのフォルダのファイルかの指定","chapter":"1 前提：プロジェクトの設定","heading":"1.1 どのフォルダのファイルかの指定","text":"Excelファイルに限らず、ファイルをRに読み込む際は、どのフォルダから読むのか、位置を正確に指定する必要があります。そこで重要となる概念が、「作業フォルダ」というものです。コンソールにgetwd()と打って出てくるフォルダが現在の作業フォルダになります。","code":""},{"path":"project.html","id":"projecttoha","chapter":"1 前提：プロジェクトの設定","heading":"1.2 プロジェクトとは","text":"RStudioの「プロジェクト」とは、作業フォルダにまつわる面倒な設定を意識しないですむ非常に便利な機能です。RStudioを開いて右上のところに設定アイコンがあります（Figure??）。ざっくり説明すると、データを加工して解析する際に、1つのフォルダ（サブフォルダも含む）の中に関連するデータやコード、出力をまとめておき、そのフォルダをプロジェクトとして設定するのです。これにより、ファイルの読み書きの際の場所指定をいちいち意識しないで作業できるようになります。したがって、本書に出てくる内容をご自身のPC上で再現するには、Githubレポジトリhttps://github.com/izunyan/excel_r をダウンロードして、その中にあるexcel_r.Rprojファイルを実行すればお手軽です。詳しくは、先述のR Data Scienceでの解説が参考になります。5","code":""},{"path":"readexcel.html","id":"readexcel","chapter":"2 Excelファイルの読み込み","heading":"2 Excelファイルの読み込み","text":"","code":""},{"path":"readexcel.html","id":"readoneexcel","chapter":"2 Excelファイルの読み込み","heading":"2.1 一つのExcelファイルを読み込む","text":"","code":""},{"path":"readexcel.html","id":"junbiyomikomi","chapter":"2 Excelファイルの読み込み","heading":"2.1.1 ファイルの準備と読み込み","text":"ExcelファイルをRに読み込むには、readxlパッケージが便利です。6セクション1.2で述べた通り、ここからは、githubレポジトリのhttps://github.com/izunyan/excel_r をダウンロードしてプロジェクトを開いて進めてみてください。dataフォルダ（data/で表現）に入っている「ペンギン.xlsx」7を読み込んでみましょう。読み込みにはread_xlsx()関数を使います。したがって、以下すべてExcelファイル形式は.xlsxを想定します。read_xls()やread_excel()という関数もあるので、ファイル形式によって使い分けられます。ファイル形式が混ざっている時はread_excel()が有用かもしれません。上記コードを実行すると、RStudioの右上（デフォルトの配置であれば）のEnvironmentタブに、という表示が出ると思います。つまり、344行のデータと9列の変数が入っているデータを、dfという名前のもの（オブジェクト）としてRに読みこんだ、ということを示しています。df <-の部分がその作業に該当します。<-の右側の内容を左側のオブジェクトに格納するという意味です。ここで読み込まれた形がデータフレーム（はじめに>本書の構成の注参照）です。オブジェクト名であるdfと打つことで、デフォルトでは最初の10行分のデータが表示されます。ここでは紙面の都合で設定を変えているので3行だけにしています。表示された最初の行にも、tibble: 344 x 9と、行数x列数の情報が出ています。表示しきれなかった行は、341 rowsと省略され、表示しきれなかった列は、flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>, year <dbl>と、名前<データの型名>が表示されます。なお、読みこんだファイルの保存については??章で解説します。","code":"\nlibrary(readxl)\n\ndf <- \n read_xlsx(\"data/繝壹Φ繧ｮ繝ｳ.xlsx\")フ# Excel繝輔ぃ繧､繝ｫ縺ｮ隱ｭ縺ｿ霎ｼ縺ｿNAdf # 繝<87>繝ｼ繧ｿ縺ｮ陦ｨ遉ｺ NA## # A tibble: 344 x 9\n##   species 種類     island    bill_length_mm bill_depth_mm\n##   <chr>   <chr>    <chr>              <dbl>         <dbl>\n## 1 Adelie  アデリー Torgersen           39.1          18.7\n## 2 Adelie  アデリー Torgersen           39.5          17.4\n## 3 Adelie  アデリー Torgersen           40.3          18  \n## # ... with 341 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>df  344 obs. of 9 variables"},{"path":"readexcel.html","id":"hokan","chapter":"2 Excelファイルの読み込み","heading":"2.1.1.1 最高な機能だよ！パスの自動補完","text":"read_xlsx(\"\")と打った後に、\" \"の中にカーソルを置いて、tabキーを押すと、プロジェクトの中身が一覧で表示されるので、選んでいくだけで目的のファイルがキーボードを打つことなしに選べます！RStudioは\" \"と打てばどこでもこの補完が可能です。8上の階層のフォルダに行きたいときは、\" \"の中に../と打てば可能です。その後にtabキーを押せば上の階層のフォルダが選べます。","code":""},{"path":"readexcel.html","id":"列名変数名がひどい場合の読み込み","chapter":"2 Excelファイルの読み込み","heading":"2.1.2 列名（変数名）がひどい場合の読み込み","text":"読めることは読めますが、今後のデータ処理を進めるうえで不安が残ります。","code":"read_xlsx(\"data/ペンギン（ひどい列名）ver.xlsx\")## # A tibble: 344 x 9\n##   Sｐｅｃｉｅｓ `種　類` `※島の名前` `①クチバシ　長さ（ｍｍ）`\n##   <chr>         <chr>    <chr>                           <dbl>\n## 1 Adelie        アデリー Torgersen                        39.1\n## 2 Adelie        アデリー Torgersen                        39.5\n## 3 Adelie        アデリー Torgersen                        40.3\n## # ... with 341 more rows, and 5 more variables:\n## #   ②ｸﾁﾊﾞｼ＿大きさ（ｍｍ） <dbl>, 翼：長さ(mm) <dbl>,\n## #   ■体重　単位はｇ <dbl>, <U+329B><U+329A> <chr>, ２００７～２００９ <dbl>"},{"path":"readexcel.html","id":"スペースや記号などを自動的に変換してくれる関数できれいに","chapter":"2 Excelファイルの読み込み","heading":"2.1.2.1 スペースや記号などを自動的に変換してくれる関数できれいに","text":"janitorパッケージのclean_names()関数を使って、列名に入り込んでいるスペースや記号などを安全な記号に変換します。なお、日本語の列名では、clean_names()関数にcase = \"old_janitor\"をつけないと読みにくい結果になります。このように、関数の中に追加する情報のことを引数（ひきすう）と言います。引数によってさまざまな条件を変更することが可能になります。さて、ここで使われている %>% は非常に大事なので解説しておきます。","code":"library(tidyverse)\n    # ↑は普通まず最初に読み込むパッケージですが、本書ではここで初めて使います\nlibrary(janitor)\n\nread_xlsx(\"data/ペンギン（ひどい列名）ver.xlsx\") %>% \n  clean_names(case = \"old_janitor\")## # A tibble: 344 x 9\n##   sｐｅｃｉｅｓ 種_類    x_島の名前 x_クチバシ_長さ_ｍｍ\n##   <chr>         <chr>    <chr>                     <dbl>\n## 1 Adelie        アデリー Torgersen                  39.1\n## 2 Adelie        アデリー Torgersen                  39.5\n## 3 Adelie        アデリー Torgersen                  40.3\n## # ... with 341 more rows, and 5 more variables:\n## #   x_ｸﾁﾊﾞｼ_大きさ_ｍｍ <dbl>, 翼_長さ_mm <dbl>,\n## #   x_体重_単位はｇ <dbl>, x_u_329b_u_329a <chr>,\n## #   ２００７_２００９ <dbl>"},{"path":"readexcel.html","id":"pipe","chapter":"2 Excelファイルの読み込み","heading":"2.1.2.2 %>% とは？","text":"「パイプ」と読みます。処理を重ねてコードに書いていきたい際に重宝し、現代のtidyverseを使ったRのコードに欠かせないものです。たとえば、データフレームdfのspecies列を選択する、という処理のはと書けます。 %>%の左側にあるものを右側の最初の部分（第1引数）に渡すという働きです。パイプの利点は、いくつもつないで書いていけることです。たとえば、ペンギンの種類別にクチバシの長さの平均値を出したいときには次のようにできます。以下では%>%を多用していきます。なお、ショートカットctrl + shit + M（MacだとCmd + Shift + M）で出せます。","code":"\nselect(df, species)\ndf %>% select(species)df %>% \n  group_by(species) %>% \n  summarise(平均値 = mean(bill_length_mm, na.rm = TRUE))## # A tibble: 3 x 2\n##   species   平均値\n##   <chr>      <dbl>\n## 1 Adelie      38.8\n## 2 Chinstrap   48.8\n## 3 Gentoo      47.5"},{"path":"readexcel.html","id":"全角半角を自動で","chapter":"2 Excelファイルの読み込み","heading":"2.1.2.3 全角←→半角を自動で","text":"stringiパッケージのstri_trans_nfkc()関数を使って、変数名で全角-半角のばらつきを統一させます。ここでは、変数名をリネームするのにdplyr 1.0.0で登場したrename_with()関数を使いました。everything()という引数を含めているので、すべての変数に対し、全角文字を含んでいたら半角に直すというコードになります。","code":"library(stringi)\nread_xlsx(\"data/ペンギン（ひどい列名）ver.xlsx\") %>% \n  rename_with(~stri_trans_nfkc(.),\n              everything())## # A tibble: 344 x 9\n##   Species `種 類`  `※島の名前` `1クチバシ 長さ(~ `2クチバシ_大き~\n##   <chr>   <chr>    <chr>                   <dbl>            <dbl>\n## 1 Adelie  アデリー Torgersen                39.1             18.7\n## 2 Adelie  アデリー Torgersen                39.5             17.4\n## 3 Adelie  アデリー Torgersen                40.3             18  \n## # ... with 341 more rows, and 4 more variables:\n## #   翼:長さ(mm) <dbl>, ■体重 単位はg <dbl>, 女男 <chr>,\n## #   2007~2009 <dbl>"},{"path":"readexcel.html","id":"上記の合わせ技","chapter":"2 Excelファイルの読み込み","heading":"2.1.2.4 上記の合わせ技","text":"%>% でつなぎ合わせて1つの実行で合わせてしまうこともできます。","code":"read_xlsx(\"data/ペンギン（ひどい列名）ver.xlsx\") %>% \n  rename_with(~stri_trans_nfkc(.),\n              everything()) %>% \n    clean_names(case = \"old_janitor\")## # A tibble: 344 x 9\n##   species 種_類    x_島の名前 x1クチバシ_長さ_mm x2クチバシ_大き~\n##   <chr>   <chr>    <chr>                   <dbl>            <dbl>\n## 1 Adelie  アデリー Torgersen                39.1             18.7\n## 2 Adelie  アデリー Torgersen                39.5             17.4\n## 3 Adelie  アデリー Torgersen                40.3             18  \n## # ... with 341 more rows, and 4 more variables:\n## #   翼_長さ_mm <dbl>, x_体重_単位はg <dbl>, 女男 <chr>,\n## #   x2007_2009 <dbl>"},{"path":"readexcel.html","id":"開始行を指定して読み込む","chapter":"2 Excelファイルの読み込み","heading":"2.1.3 開始行を指定して読み込む","text":"理想的なデータは1行目に列名が入力されている形ですが、最初の数行が空だったり、文字の説明が入っていたりすることも多いです。そうした場合は、以下のような読み込み結果になります。列名が、セルに内容が入っている行から始まり、他の列名が...1, ...3といったものになりました。そしてデータがうまく読み込めていません。これを、指定した行から読み込むには、引数skip =にとばしたい行の数を指定します。このように、ちゃんと読む込むことができました。","code":"read_xlsx(\"data/ペンギン（3行空き）.xlsx\") %>% \n  select(1:3) # 紙面の都合のため最初の3列に制限## # A tibble: 346 x 3\n##   ...1    ここに説明とか書いてあるファイル読むのつら~ ...3       \n##   <chr>   <chr>                                       <chr>      \n## 1 <NA>    <NA>                                        <NA>       \n## 2 species island                                      bill_lengt~\n## 3 Adelie  Torgersen                                   39.1       \n## # ... with 343 more rowsread_xlsx(\"data/ペンギン（3行空き）.xlsx\", skip = 3)## # A tibble: 344 x 9\n##   species island    bill_length_mm bill_depth_mm flipper_length_~\n##   <chr>   <chr>              <dbl>         <dbl>            <dbl>\n## 1 Adelie  Torgersen           39.1          18.7              181\n## 2 Adelie  Torgersen           39.5          17.4              186\n## 3 Adelie  Torgersen           40.3          18                195\n## # ... with 341 more rows, and 4 more variables:\n## #   body_mass_g <dbl>, sex <chr>, year <dbl>, 種類 <chr>"},{"path":"readexcel.html","id":"セルを指定して読み込む","chapter":"2 Excelファイルの読み込み","heading":"2.1.4 セルを指定して読み込む","text":"引数range =にセル範囲を指定すれば、そのセル範囲だけを読み込むこともできます。他にも、cell_cols =で読みたい列の指定、cell_rows =で読みたい行の指定も行えます。詳細は、?readxlと打ち込んでヘルプを見るか、readxlのwebサイト 9を参照してください。","code":"\nread_xlsx(\"data/ペンギン.xlsx\"= \"A1:D5=NA\"A1:D5\"NA)NA## # A tibble: 4 x 4\n##   species 種類     island    bill_length_mm\n##   <chr>   <chr>    <chr>              <dbl>\n## 1 Adelie  アデリー Torgersen           39.1\n## 2 Adelie  アデリー Torgersen           39.5\n## 3 Adelie  アデリー Torgersen           40.3\n## 4 Adelie  アデリー Torgersen           NA"},{"path":"readexcel.html","id":"シートを指定して読み込む","chapter":"2 Excelファイルの読み込み","heading":"2.2 シートを指定して読み込む","text":"","code":""},{"path":"readexcel.html","id":"シート名の確認","chapter":"2 Excelファイルの読み込み","heading":"2.2.1 シート名の確認","text":"複雑なExcelファイルとなると、たくさんのシートが含まれていて、その全容を知るのも一苦労です。Rでは、readxlパッケージのexcel_sheets()関数でシート名の一覧を簡単に取得できます。","code":"excel_sheets(\"data/ペンギン（シート別）.xlsx\")## [1] \"アデリー\"   \"ジェンツー\" \"ヒゲ\""},{"path":"readexcel.html","id":"普通の読み込み","chapter":"2 Excelファイルの読み込み","heading":"2.2.2 普通の読み込み","text":"シートが分かれているExcelファイルをそのまま読みこんでみます。デフォルトでは一番最初のシートのデータが読みこまれます。ここでは、シート「アデリー」が読み込まれました。","code":"read_xlsx(\"data/ペンギン（シート別）.xlsx\")## # A tibble: 152 x 9\n##   species 種類     island    bill_length_mm bill_depth_mm\n##   <chr>   <chr>    <chr>              <dbl>         <dbl>\n## 1 Adelie  アデリー Torgersen           39.1          18.7\n## 2 Adelie  アデリー Torgersen           39.5          17.4\n## 3 Adelie  アデリー Torgersen           40.3          18  \n## # ... with 149 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>"},{"path":"readexcel.html","id":"シートを指定した読み込み","chapter":"2 Excelファイルの読み込み","heading":"2.2.3 シートを指定した読み込み","text":"引数のsheet =にシート名を指定することで読み込めます。","code":"read_excel(\"data/ペンギン（シート別）.xlsx\", sheet = \"ジェンツー\" )## # A tibble: 124 x 9\n##   species 種類       island bill_length_mm bill_depth_mm\n##   <chr>   <chr>      <chr>           <dbl>         <dbl>\n## 1 Gentoo  ジェンツー Biscoe           46.1          13.2\n## 2 Gentoo  ジェンツー Biscoe           50            16.3\n## 3 Gentoo  ジェンツー Biscoe           48.7          14.1\n## # ... with 121 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>"},{"path":"readexcel.html","id":"dflist","chapter":"2 Excelファイルの読み込み","heading":"2.2.4 すべてのシートから一気に読み込み","text":"今まで身につけた知識を使うと、すべてのシートからデータを読みたいときは、単純にと１つずつ読み込めばよいとわかります。しかし、これが100シート分あったら読むだけで多くの時間がかかり、うんざりしてしまうでしょう。また、疲労によりミスも起こるかもしれません。コードも長くて読みにくくなってしまいます。そんな時に便利で正確で短くコードが書ける素敵な方法があるのです。おそらくこれを知って使えるようになることが、初心者から中級者への第一歩になるのではないでしょうか。ここで一気にレベルが上がりますが、これこそがRを使ってExcelファイルを読み込む便利な部分（その用途に限らず、コード書いてコンピュータに働いてもらうの最高！ってなる部分）なので、その魅力をみていきましょう。それぞれのExcelシートから読みこまれた3つのデータ（アデリー、ジェンツー、ヒゲ）はデータフレームとして、df_listにリストと呼ばれる形式にてまとめて格納されています。リストは最初は理解が難しいですが、慣れるとなんでもリストにしたくなるくらい便利なものです。リストの中身を個別に取り出してみてみましょう。これは、df_listというリストの中の、ジェンツーという要素（ここではデータフレーム）を取り出す、というコードです。$が「（左側にくるオブジェクト）の中の」という意味を表しています。自分でコードを打つと、df_list$と打った時点で、中の要素の一覧が表示されるはずなので、そこからクリックして選ぶこともできます。それでは、先ほど実行した読み込みコードの解説をします。これは、単にファイルの場所をpath_nameに格納しただけです。自分のデータで試してみたいときは、基本的にここのパス名を変えるだけで実行できるはずです。excel_sheets()は上で実行したのと同じです。実行結果はベクトルとして保存されています。set_names()は、ベクトルを名前付きベクトルにする働きをします。なので、ここでできるのは、です。それぞれについてpurrrパッケージのmap()関数を使ってread_excel()を1つ1つのシート（ここでは作成した名前付きベクトルの要素）に適用していき、データを読み込みデータフレームにし、1つのリストにまとめるという作業をします。繰り返し似たような作業をするときに、このmap()関数が非常に便利です。","code":"df_Adelie <- \n  read_excel(\"data/ペンギン（シート別）.xlsx\", sheet = \"アデリー\" )\ndf_Gentoo <- \n  read_excel(\"data/ペンギン（シート別）.xlsx\", sheet = \"ジェンツー\" )\ndf_Chinstrap <- \n  read_excel(\"data/ペンギン（シート別）.xlsx\", sheet = \"ヒゲ\" )path_name <- \"data/ペンギン（シート別）.xlsx\" # データのパスを格納\n\n# シート名を取得しそれぞれから読み込んでリストにまとめる\ndf_list <-\n  excel_sheets(path_name) %>%                     \n  set_names() %>%           # 名前付きベクトルにする\n  map(read_excel, path =  path_name)\n\ndf_list # 作成したリストの表示## $アデリー\n## # A tibble: 152 x 9\n##   species 種類     island    bill_length_mm bill_depth_mm\n##   <chr>   <chr>    <chr>              <dbl>         <dbl>\n## 1 Adelie  アデリー Torgersen           39.1          18.7\n## 2 Adelie  アデリー Torgersen           39.5          17.4\n## 3 Adelie  アデリー Torgersen           40.3          18  \n## # ... with 149 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## $ジェンツー\n## # A tibble: 124 x 9\n##   species 種類       island bill_length_mm bill_depth_mm\n##   <chr>   <chr>      <chr>           <dbl>         <dbl>\n## 1 Gentoo  ジェンツー Biscoe           46.1          13.2\n## 2 Gentoo  ジェンツー Biscoe           50            16.3\n## 3 Gentoo  ジェンツー Biscoe           48.7          14.1\n## # ... with 121 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## $ヒゲ\n## # A tibble: 68 x 9\n##   species   種類  island bill_length_mm bill_depth_mm\n##   <chr>     <chr> <chr>           <dbl>         <dbl>\n## 1 Chinstrap ヒゲ  Dream            46.5          17.9\n## 2 Chinstrap ヒゲ  Dream            50            19.5\n## 3 Chinstrap ヒゲ  Dream            51.3          19.2\n## # ... with 65 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>df_list$ジェンツー## # A tibble: 124 x 9\n##   species 種類       island bill_length_mm bill_depth_mm\n##   <chr>   <chr>      <chr>           <dbl>         <dbl>\n## 1 Gentoo  ジェンツー Biscoe           46.1          13.2\n## 2 Gentoo  ジェンツー Biscoe           50            16.3\n## 3 Gentoo  ジェンツー Biscoe           48.7          14.1\n## # ... with 121 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>path_name <- \"data/ペンギン（シート別）.xlsx\"\ndf_list <-\n  excel_sheets(path_name) %>%                    \n  set_names() %>%                           \n  map(read_excel, path =  path_name) \nexcel_sheets(path_name) %>%                    \n  set_names()##     アデリー   ジェンツー         ヒゲ \n##   \"アデリー\" \"ジェンツー\"       \"ヒゲ\""},{"path":"readexcel.html","id":"onedflist","chapter":"2 Excelファイルの読み込み","heading":"2.2.4.1 一つのデータフレームにする","text":"bind_rows()は、データフレームを縦に連結します。データフレームがリストになったものが引数にくると、それらをすべて縦につなげてくれます。引数.id =で、リストの要素名を変数の値として入れることができるので、どのデータフレームから来たのか識別することが可能になります。ここではgroupという名前にしています。","code":"\ndf_all <- \n  bind_rows(df_list, .id = \"group\")"},{"path":"readexcel.html","id":"作成したデータフレームの確認","chapter":"2 Excelファイルの読み込み","heading":"2.2.4.2 作成したデータフレームの確認","text":"最初の3行と最後の3行だけを表示してどんなものができたか確認します。dplyrパッケージのslice_head(), slice_tail()関数を使って、引数n =に表示したい行数を指定することで、最初および最後の数行を取得できます。一気にやるにはslice()関数が便利です。1:3は1行目から3行目、(n()-2):n()は、列数（ただし現在のgroup内）を表すn()とそれから-2行した(n()-2)で表されています。","code":"\n# 譛蛻昴<81>ｮ3陦<8c>NAdf_all %>% slice_head(n = 3)## # A tibble: 3 x 10\n##   group    species 種類     island   bill_length_mm bill_depth_mm\n##   <chr>    <chr>   <chr>    <chr>             <dbl>         <dbl>\n## 1 アデリー Adelie  アデリー Torgers~           39.1          18.7\n## 2 アデリー Adelie  アデリー Torgers~           39.5          17.4\n## 3 アデリー Adelie  アデリー Torgers~           40.3          18  \n## # ... with 4 more variables: flipper_length_mm <dbl>,\n## #   body_mass_g <dbl>, sex <chr>, year <dbl>\n# 譛蠕後<81>ｮ3陦<8c>NAdf_all %>% slice_tail(n = 3)## # A tibble: 3 x 10\n##   group species   種類  island bill_length_mm bill_depth_mm\n##   <chr> <chr>     <chr> <chr>           <dbl>         <dbl>\n## 1 ヒゲ  Chinstrap ヒゲ  Dream            49.6          18.2\n## 2 ヒゲ  Chinstrap ヒゲ  Dream            50.8          19  \n## 3 ヒゲ  Chinstrap ヒゲ  Dream            50.2          18.7\n## # ... with 4 more variables: flipper_length_mm <dbl>,\n## #   body_mass_g <dbl>, sex <chr>, year <dbl>\ndf_all %>% \n  slice(1:3, (n()-2):n())## # A tibble: 6 x 10\n##   group    species   種類     island bill_length_mm bill_depth_mm\n##   <chr>    <chr>     <chr>    <chr>           <dbl>         <dbl>\n## 1 アデリー Adelie    アデリー Torge~           39.1          18.7\n## 2 アデリー Adelie    アデリー Torge~           39.5          17.4\n## 3 アデリー Adelie    アデリー Torge~           40.3          18  \n## 4 ヒゲ     Chinstrap ヒゲ     Dream            49.6          18.2\n## 5 ヒゲ     Chinstrap ヒゲ     Dream            50.8          19  \n## 6 ヒゲ     Chinstrap ヒゲ     Dream            50.2          18.7\n## # ... with 4 more variables: flipper_length_mm <dbl>,\n## #   body_mass_g <dbl>, sex <chr>, year <dbl>"},{"path":"readexcel.html","id":"readseveralexcel","chapter":"2 Excelファイルの読み込み","heading":"2.3 複数のExcelファイルを読み込む","text":"それでは、さらにRの恩恵を深く実感できる部分に入ります。読みこみたいExcelファイルが大量にある場合です。これも実務上よく遭遇します。やり方としては、2.2.4で使った方法とほぼ同じです。ただし、ここでは読み込むファイルの構造がすべて同様の場合に限ります。残念ながら、それがかなわない状況に、現実ではたくさん遭遇します。いつか本書の応用編を書くことがあったら、そちらで解説することとして、今回は構造が単純な場合に限って解説します。おそらく、単純に思いつく方法は、と1つずつ読んでいく方法ですが、これも大量にあったら泣きたくなる作業です。1つ1つファイル名を入力やコピペする間にいくらでもミスが生じます。2.1.1.1で紹介した自動補完を使っても、楽しいのは最初だけでしょう。そこで、ファイルを指定するところから極力人の手を介さず進めていく方法を次に解説していきます。","code":"df_Adelie    <- read_xlsx(\"data/複数/アデリー.xlsx\")\ndf_Gentoo    <- read_xlsx(\"data/複数/ジェンツー.xlsx\")\ndf_Chinstrap <- read_xlsx(\"data/複数/ヒゲ.xlsx\")"},{"path":"readexcel.html","id":"読み込むファイル名の一覧のオブジェクト作成","chapter":"2 Excelファイルの読み込み","heading":"2.3.1 読み込むファイル名の一覧のオブジェクト作成","text":"まず、読み込みたいファイルが格納されているフォルダのファイル名、およびパス名の一覧を取得します。list.files()関数は、path =で指定したフォルダ内の情報を取得します。full.names = TRUEでパスも含めます。これをつけないと、ファイル名と拡張子だけの取得になります。このうち、使用するのはxlsxファイルだけなので、文字列で該当するデータを取得するstr_subset()を用い、以下のように限定します。","code":"files <-\n    list.files(path = \"data/複数/\", full.names = TRUE)\n\nfiles## [1] \"data/複数/アデリー.xlsx\"   \"data/複数/ジェンツー.xlsx\"\n## [3] \"data/複数/ヒゲ.xlsx\"       \"data/複数/フォルダ1\"      \n## [5] \"data/複数/フォルダ2\"       \"data/複数/フォルダ3\"\nfiles <- \n  files %>% str_subset(\"xlsx\")\n\nfiles## [1] \"data/複数/アデリー.xlsx\"   \"data/複数/ジェンツー.xlsx\"\n## [3] \"data/複数/ヒゲ.xlsx\""},{"path":"readexcel.html","id":"ikkatsuread","chapter":"2 Excelファイルの読み込み","heading":"2.3.2 ファイルを一括で読み込む","text":"ここでできたldataは、2.2.4で作成したdf_listと同じ構造です。違いはそれぞれのデータフレームの要素名（アデリー、ジェンツー、ヒゲ）が入っていない点です。各要素の上の部分にある名前が[[1]], [[3]], [[3]]と表示されています（つまり、1, 2, 3の数値が割り当てられている）。要素名が入っていないのは不便なので、以下で要素名を改めてつけます。","code":"\nldata <-\n    map(files, ~read_xlsx(.))\n\nldata## [[1]]\n## # A tibble: 152 x 9\n##   species 種類     island    bill_length_mm bill_depth_mm\n##   <chr>   <chr>    <chr>              <dbl>         <dbl>\n## 1 Adelie  アデリー Torgersen           39.1          18.7\n## 2 Adelie  アデリー Torgersen           39.5          17.4\n## 3 Adelie  アデリー Torgersen           40.3          18  \n## # ... with 149 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## [[2]]\n## # A tibble: 124 x 9\n##   species 種類       island bill_length_mm bill_depth_mm\n##   <chr>   <chr>      <chr>           <dbl>         <dbl>\n## 1 Gentoo  ジェンツー Biscoe           46.1          13.2\n## 2 Gentoo  ジェンツー Biscoe           50            16.3\n## 3 Gentoo  ジェンツー Biscoe           48.7          14.1\n## # ... with 121 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## [[3]]\n## # A tibble: 68 x 9\n##   species   種類  island bill_length_mm bill_depth_mm\n##   <chr>     <chr> <chr>           <dbl>         <dbl>\n## 1 Chinstrap ヒゲ  Dream            46.5          17.9\n## 2 Chinstrap ヒゲ  Dream            50            19.5\n## 3 Chinstrap ヒゲ  Dream            51.3          19.2\n## # ... with 65 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>"},{"path":"readexcel.html","id":"ファイル名抽出","chapter":"2 Excelファイルの読み込み","heading":"2.3.2.1 ファイル名抽出","text":"先ほど作成したfilesから、ファイル名部分だけに加工します。str_replace()は、stringrパッケージの、文字の置換をする関数です。ここでは、拡張子とパス名をそれぞれ\"\"、つまり空白に置換しています。","code":"file_name <- \n  str_replace(files, \".xlsx\", \"\") %>% \n  str_replace(\"data/複数/\", \"\")\n\nfile_name## [1] \"アデリー\"   \"ジェンツー\" \"ヒゲ\""},{"path":"readexcel.html","id":"リストの要素名にファイル名を付与","chapter":"2 Excelファイルの読み込み","heading":"2.3.2.2 リストの要素名にファイル名を付与","text":"2.2.4で使ったset_names()関数は、リストの要素名を付ける時にも使えます。リストldataの3つの要素に、file_nameの中身を割り当てます。このように、ちゃんと要素に名前が付きました。これらを1つのデータフレームにまとめるには、 2.2.4.1と同じ手順でできます。","code":"\nldata <-\n    set_names(ldata, file_name)\n\nldata## $アデリー\n## # A tibble: 152 x 9\n##   species 種類     island    bill_length_mm bill_depth_mm\n##   <chr>   <chr>    <chr>              <dbl>         <dbl>\n## 1 Adelie  アデリー Torgersen           39.1          18.7\n## 2 Adelie  アデリー Torgersen           39.5          17.4\n## 3 Adelie  アデリー Torgersen           40.3          18  \n## # ... with 149 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## $ジェンツー\n## # A tibble: 124 x 9\n##   species 種類       island bill_length_mm bill_depth_mm\n##   <chr>   <chr>      <chr>           <dbl>         <dbl>\n## 1 Gentoo  ジェンツー Biscoe           46.1          13.2\n## 2 Gentoo  ジェンツー Biscoe           50            16.3\n## 3 Gentoo  ジェンツー Biscoe           48.7          14.1\n## # ... with 121 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\n## \n## $ヒゲ\n## # A tibble: 68 x 9\n##   species   種類  island bill_length_mm bill_depth_mm\n##   <chr>     <chr> <chr>           <dbl>         <dbl>\n## 1 Chinstrap ヒゲ  Dream            46.5          17.9\n## 2 Chinstrap ヒゲ  Dream            50            19.5\n## 3 Chinstrap ヒゲ  Dream            51.3          19.2\n## # ... with 65 more rows, and 4 more variables:\n## #   flipper_length_mm <dbl>, body_mass_g <dbl>, sex <chr>,\n## #   year <dbl>\nbind_rows(ldata, .id = \"group\")"},{"path":"readexcel.html","id":"読み込むファイルが複数フォルダにある場合","chapter":"2 Excelファイルの読み込み","heading":"2.3.3 読み込むファイルが複数フォルダにある場合","text":"data/複数フォルダの中に、さらにフォルダ1～フォルダ3がありました。この中にもそれぞれxlsxファイルが入っていて、それぞれ読み込みたいとします。その場合は、先ほど使ったlist.files()関数の引数、recursive = TRUEを追加します。これによって、フォルダの深い階層までもすべて読み込むことが可能になります。このうち、使用するのはフォルダ1～3に入っているxlsxファイルだけなので、str_subset()関数で以下のように絞り込みます。ここの\"\"の中に入る文字列がどうなるかが難しいところかもしれませんが、ここは正規表現という本書の範囲を超える世界なので、深入りはしません。あとは2.3.2と同じ手順で読み込めます。","code":"files <-\n    list.files(path = \"data/複数/\", full.names = TRUE, recursive = TRUE)\n\nfiles## [1] \"data/複数//フォルダ1/アデリー.xlsx\"  \n## [2] \"data/複数//フォルダ2/ジェンツー.xlsx\"\n## [3] \"data/複数//フォルダ3/ヒゲ.xlsx\"      \n## [4] \"data/複数/アデリー.xlsx\"             \n## [5] \"data/複数/ジェンツー.xlsx\"           \n## [6] \"data/複数/ヒゲ.xlsx\"\nfiles <- \n  files %>% str_subset(\"フォルダ\"NA)NA"},{"path":"あとがき.html","id":"あとがき","chapter":"あとがき","heading":"あとがき","text":"初めての同人誌執筆が終わろうとしています。執筆に用いたBookdownについて前より理解が深まったと同時に、全然わからないことも増えました。。執筆途中で、メインで使っていたノートPCの充電ができなくなるというアクシデントにも見舞われました。こうした様々な学びを活かして、次回作につなげられればと思います。本書の執筆にあたり、同人誌制作の先輩である天川榎@EnokiAmakawa氏から背中押し＆多くの助言をいただきました。この場を借りてお礼申し上げます。この本の内容が、なるべく多くの方に届いて、みんなの仕事の効率化につながればうれしいです。そして、Rの可能性がさらに多くの方に認識され、Rを使ってお仕事できる環境が一層整っていくことを願ってやみません。","code":""}]
