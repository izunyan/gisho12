# 要約値を作る {#summarise}

* パッケージ`dplyr`の関数`summarise()`
* 結果をデータフレームとして出力するため，扱いが便利
* データの要約作業はデータを知るうえで頻繁に行うことが想定される
  + 便利な要約パッケージが色々あるものの，`summarise()`を使いこなせると役に立つことが多い



## 基本 {#summarise-standard}

* `( )`の中に出力したい変数名を書き，`=`の後に関数を入れる
* NAがある場合，引数`na.rm = TRUE`がないと結果が出ないので，ほとんどの場合つけて置いた方がよい

```{r}
df %>% 
  summarise(blm_平均値 = mean(bill_length_mm, na.rm = TRUE))
```

### 複数の計算 {#summarise-standard-multiple}

* 複数の変数について平均値とSDとnを出したいときは，基本知識では全部書くので長くなる

```{r}
df %>% 
  summarise(blm_mean = mean(bill_length_mm, na.rm = TRUE),
            bdm_mean = mean(bill_depth_mm, na.rm = TRUE),
            blm_sd = sd(bill_length_mm, na.rm = TRUE),
            bdm_sd = sd(bill_depth_mm, na.rm = TRUE),
            blm_n  = sum(!is.na(bill_length_mm)),
            bdm_n  = sum(!is.na(bill_depth_mm)))

```

#### 【効率化】
```{r}
df %>% 
  summarise(across(c(bill_length_mm, bill_depth_mm),
                   list(mean = ~mean(., na.rm = TRUE),
                        sd = ~sd(., na.rm = TRUE),
                        n = ~sum(!is.na(.)))))
```


* `across()`ではヘルパー関数が使える！

```{r}
df %>% 
  summarise(across(starts_with("bill"),
                   list(mean = ~mean(., na.rm = TRUE),
                        sd = ~sd(., na.rm = TRUE),
                        n = ~sum(!is.na(.)))))
```

#### 【並び替え】

* `tidyr::pivot_longer()`で，データフレームの行列入れ替えができる
* 引数


```{r}
df %>% 
  summarise(across(bill_length_mm:body_mass_g,
                   list(mean = ~mean(., na.rm = TRUE),
                        sd = ~sd(., na.rm = TRUE),
                        n = ~sum(!is.na(.))))) %>% 
  pivot_longer(everything(),
               names_to = c("items", ".value"), # ".value"の部分を列名に
               names_pattern = "(.*)_(.*)") 　  # 正規表現
```


###  {#summarise-range}

* 関心ある変数が指定された範囲に含まれていれば`:`でつなげて取得できる
  + 変数の連番をまとめて指定する時などに便利（例 `変数1:変数100`）

```{r}
df %>% 
  select(bill_length_mm:flipper_length_mm)
```

* 範囲に加えて追加の変数を追加できる
  + 飛び飛びの変数群を選びたいときに有用

```{r}
df %>% 
  select(bill_length_mm:flipper_length_mm, sex)
```

